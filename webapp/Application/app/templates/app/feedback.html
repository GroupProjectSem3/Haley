{% extends "app/mainlayout.html" %}

{% block content %}
{% load static %}
<style>

.imgDetails {
  width: 100px;
  float: left;
  margin-top: 30px
}



</style>
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-lg-6">
        <h1>Feedback</h1>

      </div><!-- /.col -->
      <!-- /.col -->
     </div>
  </div>
</div>
<div class="content">

  <div class="container-fluid">
<div class="row">  
  <div class="col-lg-1">
  </div>
          <div class="col-lg-8">
 
           <form method="POST">
             {% csrf_token %}	
             
               <div class="card card-info" > 
               <div class="card-header">
                 <!-- <h5 class="m-0">How severe suffering with the symptom - ?</h5> -->
                 <label>Hi {{fname}} {{lname}}, we appreciate your efforts to give valueable feeedback about Haley's predictions about your diagnosis.</label>
                 
               </div>
               <!-- For showing message if no records exists -->
               <div id="noDataMsg" class="row" style="display: none;">     <div class="col-lg-3"></div>
               <div> <label style="color: red;">There are no Diagnosis history to provide the feedback..</label></div>
               </div>
               <br>
               <div class="row">     <div class="col-lg-1"></div>
               <div> <label>Please Select the diagnosis for which you want to give feedback</label></div>
               </div>
               <div class="row">     <div class="col-lg-1"></div>
                 <div class="col-lg-6">
               <div class="form-group" data-select2-id="">
              <!-- <br> -->
              <select id="ddlSelect" class="form-control select2 select2-hidden-accessible" style="width: 100%;" tabindex="-1" aria-hidden="true" aria-placeholder="Select diagnosis">
                <!-- <select id="ddlSelect" class="form-control select2 select2-hidden-accessible" style="width: 100%;" data-select2-id="1" tabindex="-1" aria-hidden="true" aria-placeholder="Select diagnosis"> -->
                  <!-- <option selected="selected" data-select2-id="3">Alabama</option> -->
                  <!-- <option data-select2-id="1">Diagnosis 1</option>
                  <option data-select2-id="2">Diagnosis 2</option> -->
               
                </select>
              </div>
              </div>
              </div>
              <hr>
              <div class="row">     <div class="col-lg-1"></div>
               <div> <label>How satisfied are you with Haley's prediction of your diagnosis ?</label></div>

               </div>
                 <!-- <p style="text-align: right;padding-right: 10px;color:darkorange;font-family: 'Font Awesome 5 Free';">(* Select on one of the Smiley Icon)</p> -->
               <br>
                  <div class="row">
                    <div class="col-lg-1"> </div>
                   <!-- <div class="col-lg-2"> 
                     <button type="button" name="btn" id="#"  value="1" style="font-size:50px;border:none;background-color:white;padding-left: 8px;"><img src="{% static 'dist/img/f1.png' %}"alt=""></button>
                    
                     <br> <label >Very Unsatisfied</label>
                   </div> -->
                   <!-- <div class="col-lg-2"> 
                    <button class="img-overlay1">
                      <img src="{% static 'dist/img/f1.png' %}" alt="">
                      <div class="overlay1"></div>
                    </button>
                    <br> <label >Very Unsatisfied</label>
                  </div>   -->

                  <div class="col-lg-2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <img id="imgRating" class="high" src="/static/dist/img/f1.png" alt="1">
                      <br>  <label style="padding-top: 13px;">Very Unsatisfied</label>
                 </div>
                  
                  <div class="col-lg-2"> &nbsp;&nbsp;
                    <img id="imgRating" class="high" src="{% static 'dist/img/f2.png' %}" alt="2">
                    <br> <label  style="padding-top: 13px;padding-right: 6px;">Unsatisfied</label>
                  </div>
                      

                    <!-- <button type="button" name="btn" id="#"  value="2" style="font-size:50px;border:none;background-color:white;" >&#128543;</button> -->

                   <!-- <div class="col-lg-2"> 
                     <button type="button" name="btn" id="#"  value="2" style="font-size:50px;border:none;background-color:white;" ><img src="{% static 'dist/img/f2.png' %}" alt=""></button>
                 
                     <br> <label class="text-center" style="padding-left: 6px;padding-right: 6px;">Unsatisfied</label>
                   </div> -->
                   <div class="col-lg-2"> 
                    <img id="imgRating" class="high" src="{% static 'dist/img/f3.png' %}" alt="3">
                   
                     <br> <label  style="padding-left: 5px;padding-top: 11px;">Neutral</label>
                   </div>
                   <div class="col-lg-2"> 
                    <img id="imgRating" class="high" src="{% static 'dist/img/f4.png' %}" alt="4">
                     
                     <br> <label  style="padding-top: 11px;">Satisfied</label>
                   </div>
                   <div class="col-lg-2" id="divId"> &nbsp;&nbsp;
                    <img id="imgRating" class="high" src="{% static 'dist/img/f5.png' %}" alt="5">
                    
                     <br> <label style="padding-top: 11px;padding-right: 3px;" >Very Satisfied</label>
                     <br>
                   </div>
                 </div>
                
 
                 <!-- <br>   -->
                <hr>
                 <div class="row">     <div class="col-lg-1"></div>
                 <div> <label>Did Haley predict the disease accurately? If not, what do you suffer from ?</label></div>
                 </div>

                 <div class="row">     <div class="col-lg-1"></div>
                 <div class="col-lg-10">
                 <div class="form-group">
                
                    <textarea id="txtRating" name="txtRating" class="form-control" rows="4" placeholder="Enter ..."></textarea>
                  </div></div>
                  <br>
                  
                </div>
                  <div class="row">
                    <div class="col-lg-10">
                        <label id="lblImgValue" style="visibility: hidden; height: 20px;"></label>
                    </div>
                    <div class="col-lg-2">
                    <button type="button" id="btnFeedbackSubmit" name="btnFeedbackSubmit" class="btn  btn-primary "> Submit  </button> <br>
                  </div></div>
           </form>
          
        </div>
      </div> 
      
    </div>
  </div>
{% endblock %}
{% block javascript %}
<script>
var images = document.getElementsByClassName('high');
var imagesLen = images.length;

// loop through each image and and addEventListener for each one
for ( var i = 0 ; i < imagesLen; i++) {
  images[i].addEventListener('click', function () {
    resetBorder();
		addBorderTo(this);
  });
}

// make a new loop for each click and reset images by it
function resetBorder() {
  for (var v = 0; v < imagesLen; v++) {
    images[v].style.border = '';
  }
}

function addBorderTo(thisImage) {
  thisImage.style.border = '2px solid darkcyan';
  $("#lblImgValue").html($(thisImage).attr('alt'));
}

$(document).ready(function () {

  $.ajax({
        url: '/feedback/',
        data: {
          'type' : 'LOAD',
        },
        dataType: 'json',
        success: function (data) {
          if (data.is_taken) {
            var list_html = "<option value='-1'>--- Select the Diagnosis ---</option>";
            if(data.diag.length > 0)
            {
              for( var i=0; i <data.diag.length; i++) {
                  //list_html += "<option value='"+data.diag[i]['id']+"'>"+data.diag[i]['userResults']+"</option>";
                  dt = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(on " + data.diag[i]['create_date'] +")";
                  list_html += "<option value='"+data.diag[i]['id']+"'>"+data.diag[i]['userResults']+ dt +"</option>";
                 }
              $("#ddlSelect").prop("disabled", false);
              $("#noDataMsg").hide();
            }
            else{
              $("#noDataMsg").show();
              $("#ddlSelect").prop("disabled", true);
            }
            $("#ddlSelect").html(list_html);
          }
        }
      });
});

// Submit button click
$("#btnFeedbackSubmit").click(function () {
    if($("#ddlSelect option:selected").val() == -1){
      alert('please select the Diagnosis to provide feedback..');
      $("#ddlSelect").focus();
         return false;
    }

    if($("#lblImgValue").html() == ""){
         alert('please select one Smiley for rating..');
         return false; } 
    var symptom = '';
    // if($("#lblFirst").is(":visible"))
    // {
    //   symptom = $("#lblFirst").html();
    // }
    // else
    // {
    //   symptom = $("#lblSymp").html();
    // }
    //$("#imgRating").style.border='';
    $("#imgRating").blur();
    
    $("#txtRating").html("");  
      $.ajax({
        url: '/feedback/',
        data: {
          'unique_id': $("#ddlSelect option:selected" ).val(),
          'rating': $("#lblImgValue").html(),
          'ratingText': $("#txtRating").val(),
          'type' : 'SUBMIT',
        },
        dataType: 'json',
        success: function (data) {
          $("#lblImgValue").html("")
          if (data.is_taken) {
            var list_html = "<option value='-1'>--- Select the Diagnosis ---</option>";
                for( var i=0; i <data.diag.length; i++) {
                  //list_html += "<option value='"+data.diag[i]['id']+"'>"+data.diag[i]['userResults']+"</option>";
                  dt = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(on " + data.diag[i]['create_date'] +")";
                  list_html += "<option value='"+data.diag[i]['id']+"'>"+data.diag[i]['userResults']+ dt +"</option>";
                 }
                $("#ddlSelect").html(list_html);
                alert('Feedback saved successfully');
          //$("#imgRating").style.border='';
          $("#txtRating").val(""); 
          resetBorder();     
          }
          else{
            // $("#divResults").show();
            // $("#divQuestions").hide();
            // $("#lblDiseaseName").html(data.forDiseases);
            // $("#pDesc").html(data.forDesc);
            // $("#pCauses").html(data.forCauses);
            // $("a[href='http://www.default.com/']").attr('href', data.forLink);
            // $("#diseaseImage").attr("src", "../../static/dist/img/disease/"+data.forDiseases+".jpg");

          }
        }
      });
    });

</script>
{% endblock %}
